!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).TQSDK=t()}(this,(function(){"use strict";var version="1.0.33",db_version="3",bind=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},isBuffer_1=function(e){return null!=e&&(isBuffer(e)||isSlowBuffer(e)||!!e._isBuffer)};function isBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isBuffer(e.slice(0,0))}var toString=Object.prototype.toString;function isArray(e){return"[object Array]"===toString.call(e)}function isArrayBuffer(e){return"[object ArrayBuffer]"===toString.call(e)}function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData}function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isObject(e){return null!==e&&"object"==typeof e}function isDate(e){return"[object Date]"===toString.call(e)}function isFile(e){return"[object File]"===toString.call(e)}function isBlob(e){return"[object Blob]"===toString.call(e)}function isFunction(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function trim(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function merge(){var e={};function t(t,n){"object"==typeof e[n]&&"object"==typeof t?e[n]=merge(e[n],t):e[n]=t}for(var n=0,r=arguments.length;n<r;n++)forEach(arguments[n],t);return e}function extend(e,t,n){return forEach(t,(function(t,r){e[r]=n&&"function"==typeof t?bind(t,n):t})),e}var utils={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer_1,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim},normalizeHeaderName=function(e,t){utils.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},enhanceError=function(e,t,n,r,o){return e.config=t,n&&(e.code=n),e.request=r,e.response=o,e},createError=function(e,t,n,r,o){var i=new Error(e);return enhanceError(i,t,n,r,o)},settle=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(createError("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)};function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(utils.isURLSearchParams(t))r=t.toString();else{var o=[];utils.forEach(t,(function(e,t){null!=e&&(utils.isArray(e)?t+="[]":e=[e],utils.forEach(e,(function(e){utils.isDate(e)?e=e.toISOString():utils.isObject(e)&&(e=JSON.stringify(e)),o.push(encode(t)+"="+encode(e))})))})),r=o.join("&")}return r&&(e+=(-1===e.indexOf("?")?"?":"&")+r),e},ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders=function(e){var t,n,r,o={};return e?(utils.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=utils.trim(e.substr(0,r)).toLowerCase(),n=utils.trim(e.substr(r+1)),t){if(o[t]&&ignoreDuplicateOf.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o},isURLSameOrigin=utils.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=utils.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function E(){this.message="String contains an invalid character"}function btoa$1(e){for(var t,n,r=String(e),o="",i=0,a=chars;r.charAt(0|i)||(a="=",i%1);o+=a.charAt(63&t>>8-i%1*8)){if((n=r.charCodeAt(i+=.75))>255)throw new E;t=t<<8|n}return o}E.prototype=new Error,E.prototype.code=5,E.prototype.name="InvalidCharacterError";var btoa_1=btoa$1,cookies=utils.isStandardBrowserEnv()?{write:function(e,t,n,r,o,i){var a=[];a.push(e+"="+encodeURIComponent(t)),utils.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),utils.isString(r)&&a.push("path="+r),utils.isString(o)&&a.push("domain="+o),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},btoa$2="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||btoa_1,xhr=function(e){return new Promise((function(t,n){var r=e.data,o=e.headers;utils.isFormData(r)&&delete o["Content-Type"];var i=new XMLHttpRequest,a="onreadystatechange",s=!1;if("test"===process.env.NODE_ENV||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in i||isURLSameOrigin(e.url)||(i=new window.XDomainRequest,a="onload",s=!0,i.onprogress=function(){},i.ontimeout=function(){}),e.auth){var u=e.auth.username||"",c=e.auth.password||"";o.Authorization="Basic "+btoa$2(u+":"+c)}if(i.open(e.method.toUpperCase(),buildURL(e.url,e.params,e.paramsSerializer),!0),i.timeout=e.timeout,i[a]=function(){if(i&&(4===i.readyState||s)&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in i?parseHeaders(i.getAllResponseHeaders()):null,o={data:e.responseType&&"text"!==e.responseType?i.response:i.responseText,status:1223===i.status?204:i.status,statusText:1223===i.status?"No Content":i.statusText,headers:r,config:e,request:i};settle(t,n,o),i=null}},i.onerror=function(){n(createError("Network Error",e,null,i)),i=null},i.ontimeout=function(){n(createError("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",i)),i=null},utils.isStandardBrowserEnv()){var f=cookies,l=(e.withCredentials||isURLSameOrigin(e.url))&&e.xsrfCookieName?f.read(e.xsrfCookieName):void 0;l&&(o[e.xsrfHeaderName]=l)}if("setRequestHeader"in i&&utils.forEach(o,(function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete o[t]:i.setRequestHeader(t,e)})),e.withCredentials&&(i.withCredentials=!0),e.responseType)try{i.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&i.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){i&&(i.abort(),n(e),i=null)})),void 0===r&&(r=null),i.send(r)}))},DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils.isUndefined(e)&&utils.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return"undefined"!=typeof XMLHttpRequest?e=xhr:"undefined"!=typeof process&&(e=xhr),e}var defaults={adapter:getDefaultAdapter(),transformRequest:[function(e,t){return normalizeHeaderName(t,"Content-Type"),utils.isFormData(e)||utils.isArrayBuffer(e)||utils.isBuffer(e)||utils.isStream(e)||utils.isFile(e)||utils.isBlob(e)?e:utils.isArrayBufferView(e)?e.buffer:utils.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):utils.isObject(e)?(setContentTypeIfUnset(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],(function(e){defaults.headers[e]={}})),utils.forEach(["post","put","patch"],(function(e){defaults.headers[e]=utils.merge(DEFAULT_CONTENT_TYPE)}));var defaults_1=defaults;function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},InterceptorManager.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function(e){utils.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1=InterceptorManager,transformData=function(e,t,n){return utils.forEach(n,(function(n){e=n(e,t)})),e},isCancel=function(e){return!(!e||!e.__CANCEL__)},isAbsoluteURL=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},combineURLs=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e};function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var dispatchRequest=function(e){return throwIfCancellationRequested(e),e.baseURL&&!isAbsoluteURL(e.url)&&(e.url=combineURLs(e.baseURL,e.url)),e.headers=e.headers||{},e.data=transformData(e.data,e.headers,e.transformRequest),e.headers=utils.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),utils.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults_1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData(t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))};function Axios(e){this.defaults=e,this.interceptors={request:new InterceptorManager_1,response:new InterceptorManager_1}}Axios.prototype.request=function(e){"string"==typeof e&&(e=utils.merge({url:arguments[0]},arguments[1])),(e=utils.merge(defaults_1,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[dispatchRequest,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},utils.forEach(["delete","get","head","options"],(function(e){Axios.prototype[e]=function(t,n){return this.request(utils.merge(n||{},{method:e,url:t}))}})),utils.forEach(["post","put","patch"],(function(e){Axios.prototype[e]=function(t,n,r){return this.request(utils.merge(r||{},{method:e,url:t,data:n}))}}));var Axios_1=Axios;function Cancel(e){this.message=e}Cancel.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0;var Cancel_1=Cancel;function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new Cancel_1(e),t(n.reason))}))}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken.source=function(){var e;return{token:new CancelToken((function(t){e=t})),cancel:e}};var CancelToken_1=CancelToken,spread=function(e){return function(t){return e.apply(null,t)}};function createInstance(e){var t=new Axios_1(e),n=bind(Axios_1.prototype.request,t);return utils.extend(n,Axios_1.prototype,t),utils.extend(n,t),n}var axios=createInstance(defaults_1);axios.Axios=Axios_1,axios.create=function(e){return createInstance(utils.merge(defaults_1,e))},axios.Cancel=Cancel_1,axios.CancelToken=CancelToken_1,axios.isCancel=isCancel,axios.all=function(e){return Promise.all(e)},axios.spread=spread;var axios_1=axios,default_1=axios;axios_1.default=default_1;var axios$1=axios_1;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var eventemitter3=createCommonjsModule((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new o(r,i||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,a=new Array(i);o<i;o++)a[o]=r[o].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,o,i,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,f=this._events[s],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,r),!0;case 4:return f.fn.call(f.context,t,r,o),!0;case 5:return f.fn.call(f.context,t,r,o,i),!0;case 6:return f.fn.call(f.context,t,r,o,i,a),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];f.fn.apply(f.context,u)}else{var d,h=f.length;for(c=0;c<h;c++)switch(f[c].once&&this.removeListener(e,f[c].fn,void 0,!0),l){case 1:f[c].fn.call(f[c].context);break;case 2:f[c].fn.call(f[c].context,t);break;case 3:f[c].fn.call(f[c].context,t,r);break;case 4:f[c].fn.call(f[c].context,t,r,o);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];f[c].fn.apply(f[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||r&&s.context!==r||a(this,i);else{for(var u=0,c=[],f=s.length;u<f;u++)(s[u].fn!==t||o&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[i]=1===c.length?c[0]:c:a(this,i)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),IsEmptyObject=function(e){return e&&e.constructor===Object&&0===Object.keys(e).length},RandomStr=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),n="",r=0;r<e;r++)n+=t[62*Math.random()|0];return n};function _genList(e){for(var t=[],n=e.split("|"),r=0;r<n.length;r++)t.push(n[r].trim());return t}function _genItem(e,t){for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n}function _genTableRow(e,t,n,r){var o={state:e,state_detail:t,isRow:!1,row:null};switch(t){case"T":""===r.replace(/-/g,"")?o.state_detail="C":n[e]=_genList(r);break;case"C":""===r.replace(/-/g,"")?o.state_detail="S":(o.isRow=!0,o.row=_genItem(n[e],_genList(r)));break;case"S":""===r.replace(/-/g,"")&&(o.state="",o.state_detail="")}return o}var ParseSettlementContent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===e)return e;var t=e.split("\n"),n="",r="",o={},i={positionClosed:"平仓明细 Position Closed",transactionRecords:"成交记录 Transaction Record",positions:"持仓汇总 Positions",positionsDetail:"持仓明细 Positions Detail",delivery:"交割明细  Delivery"},a=[],s=[],u={account:{}};Object.entries(i).forEach((function(e){a.push(e[0]),s.push(e[1]),u[e[0]]=[]}));for(var c=0;c<t.length;c++){var f=t[c].trim();if("资金状况  币种：人民币  Account Summary  Currency：CNY"!==f){if(s.includes(f))n=a[s.indexOf(f)],r="T",c++;else if("A-S"===n){if(0===f.length||""===f.replace("-","")){n="";continue}f.match(/([\u4e00-\u9fa5][\u4e00-\u9fa5\s]+[\u4e00-\u9fa5])+/g);for(var l=f.match(/([A-Z][a-zA-Z\.\/\(\)\s]+)[:：]+/g),d=f.match(/(-?[\d]+\.\d\d)/g),h=0;h<l.length;h++)u.account[l[h].split(/[:：]/)[0]]=d[h]}else if(a.includes(n)){if(0===f.length){n="";continue}var p=_genTableRow(n,r,o,f);n=p.state,r=p.state_detail,p.isRow&&u[n].push(p.row)}}else n="A-S",c++}return u},TqWebsocket=function(_EventEmitter){function TqWebsocket(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,TqWebsocket),(t=_possibleConstructorReturn(this,_getPrototypeOf(TqWebsocket).call(this))).urlList=e instanceof Array?e:[e],t.ws=null,t.queue=[],t.reconnect=!0,t.reconnectTask=null,t.reconnectInterval=n.reconnectInterval?n.reconnectInterval:3e3,t.reconnectMaxTimes=n.reconnectMaxTimes?n.reconnectMaxTimes:5,t.reconnectTimes=0,t.reconnectUrlIndex=0,t.STATUS={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},t.__init(),t}return _inherits(TqWebsocket,_EventEmitter),_createClass(TqWebsocket,[{key:"send",value:function(e){var t=JSON.stringify(e);this.isReady()?this.ws.send(t):this.queue.push(t)}},{key:"isReady",value:function(){return this.ws.readyState===WebSocket.OPEN}},{key:"__init",value:function __init(){this.ws=new WebSocket(this.urlList[this.reconnectUrlIndex]),this.reconnectUrlIndex===this.urlList.length-1&&(this.reconnectTimes+=1);var _this=this;this.ws.onmessage=function(message){var data=eval("("+message.data+")");_this.emit("message",data),setImmediate((function(){_this.ws.send('{"aid":"peek_message"}')}))},this.ws.onclose=function(e){console.log("close",e),_this.emit("close"),_this.queue=[],_this.reconnect&&(_this.reconnectMaxTimes<=_this.reconnectTimes?(clearTimeout(_this.reconnectTask),_this.emit("death",{msg:"超过重连次数"+_this.reconnectMaxTimes})):_this.reconnectTask=setTimeout((function(){3===_this.ws.readyState&&(_this.reconnectUrlIndex=_this.reconnectUrlIndex+1<_this.urlList.length?_this.reconnectUrlIndex+1:0,_this.__init(),_this.emit("reconnect",{msg:"发起重连第 "+_this.reconnectTimes+" 次"}))}),_this.reconnectInterval))},this.ws.onerror=function(e){_this.emit("error",e),_this.ws.close()},this.ws.onopen=function(){for(_this.emit("open",{msg:"发起重连第 "+_this.reconnectTimes+" 次, 成功"}),_this.reconnectTimes=0,_this.reconnectUrlIndex=0,this.reconnectTask&&clearTimeout(_this.reconnectTask);_this.queue.length>0&&1===_this.ws.readyState;)_this.ws.send(_this.queue.shift())}}},{key:"close",value:function(){this.ws.onclose=function(){},this.ws.close()}}]),TqWebsocket}(eventemitter3),TqTradeWebsocket=function(e){function t(e,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,o))).dm=n,r.req_login=null,r.init(),r}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){var e=this;this.on("message",(function(t){if("rtn_data"===t.aid){for(var n=e._separateNotifies(t.data),r=0;r<n.length;r++)e.emit("notify",n[r]);e.dm.mergeData(t.data)}else if("rtn_brokers"===t.aid)e.emit("rtn_brokers",t.brokers);else if("qry_settlement_info"===t.aid){var o=ParseSettlementContent(t.settlement_info);e.dm.mergeData({trade:_defineProperty({},t.user_name,{his_settlements:_defineProperty({},t.trading_day,o)})}),TQSDK.store&&TQSDK.store.setContent(t.user_name,t.trading_day,t.settlement_info)}})),this.on("reconnect",(function(){e.req_login&&e.send(e.req_login)}))}},{key:"_separateNotifies",value:function(e){for(var t=[],n=0;n<e.length;n++)if(e[n].notify){var r=e.splice(n--,1)[0].notify;for(var o in r)t.push(r[o])}return t}},{key:"send",value:function(e){"req_login"===e.aid&&(this.req_login=e),_get(_getPrototypeOf(t.prototype),"send",this).call(this,e)}}]),t}(TqWebsocket),TqQuoteWebsocket=function(e){function t(e,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,o))).dm=n,r.subscribe_quote=null,r.charts={},r.init(),r}return _inherits(t,e),_createClass(t,[{key:"init",value:function(){var e=this;this.on("message",(function(t){"rtn_data"===t.aid&&e.dm.mergeData(t.data)})),this.on("reconnect",(function(t){for(var n in console.log(t),e.subscribe_quote&&e.send(e.subscribe_quote),e.charts)e.charts[n].view_width>0&&e.send(e.charts[n])}))}},{key:"send",value:function(e){"subscribe_quote"===e.aid?null!==this.subscribe_quote&&JSON.stringify(e.ins_list)===JSON.stringify(this.subscribe_quote.ins_list)||(this.subscribe_quote=e,_get(_getPrototypeOf(t.prototype),"send",this).call(this,e)):"set_chart"===e.aid&&(0===e.view_width?this.charts[e.chart_id]&&delete this.charts[e.chart_id]:this.charts[e.chart_id]=e,_get(_getPrototypeOf(t.prototype),"send",this).call(this,e))}}]),t}(TqWebsocket),QUOTE=function(){function e(){_classCallCheck(this,e),this.instrument_id="",this.datetime="",this._last_price="-",this.ask_price1="-",this.ask_volume1="-",this.bid_price1="-",this.bid_volume1="-",this.highest="-",this.lowest="-",this.open="-",this.close="-",this.average="-",this.volume="-",this.amount="-",this.open_interest="-",this.lower_limit="-",this.upper_limit="-",this.settlement="-",this.change="-",this.change_percent="-",this.strike_price=NaN,this.pre_open_interest="-",this.pre_close="-",this.pre_volume="-",this._pre_settlement="-",this.margin="-",this.commission="-"}return _createClass(e,[{key:"setChange",value:function(){Number.isFinite(this._last_price)&&Number.isFinite(this._pre_settlement)&&0!==this._pre_settlement&&(this.change=this._last_price-this._pre_settlement,this.change_percent=this.change/this._pre_settlement*100)}},{key:"last_price",set:function(e){this._last_price=e,this.setChange()},get:function(){return this._last_price}},{key:"pre_settlement",set:function(e){this._pre_settlement=e,this.setChange()},get:function(){return this._pre_settlement}}]),e}(),DataManager=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._epoch=0,e._data=n,e._diffs=[],e}return _inherits(t,e),_createClass(t,[{key:"mergeData",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Array.isArray(e)?e:[e];n&&(this._epoch+=1,this._diffs=o);var i=!0,a=!1,s=void 0;try{for(var u,c=this._diffs[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var f=u.value;null===f||IsEmptyObject(f)||t.MergeObject(this._data,f,this._epoch,r)}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}n&&this._data._epoch===this._epoch&&this.emit("data",null)}},{key:"isChanging",value:function(e){if(Array.isArray(e)){for(var t=this._data,n=0;n<e.length;n++){if((t=t[e[n]])._epoch&&t._epoch===this._epoch)return!0;if(void 0===t)return!1}return!1}return!(!e||!e._epoch)&&e._epoch===this._epoch}},{key:"setDefault",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._data;return t.SetDefault(r,e,n)}},{key:"getByPath",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._data;return t.GetByPath(n,e)}}]),t}(eventemitter3);DataManager.SetDefault=function(e,t,n){for(var r=e,o=0;o<t.length;o++){if("string"!=typeof t[o]&&"number"!=typeof t[o]){console.error("SetDefault, pathArray 中的元素必須是 string or number, but pathArray = ",t);break}var i=t[o];i in r?r=r[i]:r[i]=o===t.length-1?n:{}}return r},DataManager.GetByPath=function(e,t){for(var n=e,r=0;r<t.length;r++)if(null==(n=n[t[r]]))return n;return n},DataManager.MergeObject=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];for(var o in t){var i=t[o],a=_typeof(i);if(["string","boolean","number"].contains(a))e[o]="NaN"===i?NaN:i;else if(null===i&&r)delete e[o];else if(Array.isArray(i))e[o]=i;else if("object"===a)if(e[o]="data"===o?[]:{},"quotes"===o)for(var s in i){var u=i[s];null!==u?(e[o][s]||(e[o][s]=new QUOTE),DataManager.MergeObject(e[o][s],u,n,r)):r&&s&&delete e[o][s]}else DataManager.MergeObject(e[o],i,n,r)}e._epoch||Object.defineProperty(e,"_epoch",{configurable:!1,enumerable:!1,writable:!0}),e._epoch=n};var TQSDK=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.symbolsServerUrl,o=void 0===r?"https://openmd.shinnytech.com/t/md/symbols/latest.json":r,i=n.wsQuoteUrl,a=void 0===i?"wss://openmd.shinnytech.com/t/md/front/mobile":i,s=n.wsTradeUrl,u=void 0===s?"wss://openmd.shinnytech.com/trade/shinny":s,c=n.clientSystemInfo,f=void 0===c?"":c,l=n.clientAppId,d=void 0===l?"":l;_classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._symbol_services_url=o,e._ws_quote_url=a,e._ws_trade_url=u,e.clientSystemInfo=f,e.clientAppIds=d,e._prefix="TQJS_";var h=_assertThisInitialized(e);return e.dm=new DataManager,e.dm.on("data",(function(){h.emit("rtn_data",null)})),e.brokers=null,e.trade_accounts={},e.isReady=!1,e.quotesWs=new TqQuoteWebsocket(a,e.dm),e.quotesInfo={},e.defaultTradeWs=new TqTradeWebsocket(u,e.dm),e.defaultTradeWs.on("rtn_brokers",(function(e){h.brokers=e,h.emit("rtn_brokers",e)})),axios$1.get(e._symbol_services_url,{headers:{Accept:"application/json; charset=utf-8"}}).then((function(e){h.quotesInfo=e.data,h.isReady=!0,h.emit("ready"),h.emit("rtn_data",null)})).catch((function(e){return h.emit("error",e),console.error("Error: "+e.message),e})),e}return _inherits(t,e),_createClass(t,[{key:"addAccount",value:function(e,t,n){if(e&&t&&n){if(!this.trade_accounts[t]){var r=null===this.defaultTradeWs.req_login?this.defaultTradeWs:new TqTradeWebsocket(this._ws_trade_url,this.dm),o=this;r.on("notify",(function(n){o.emit("notify",Object.assign(n,{bid:e,user_id:t}))})),this.trade_accounts[t]={bid:e,userId:t,password:n,ws:r}}return this.trade_accounts[t]}return null}},{key:"removeAccount",value:function(e,t){e&&t&&this.trade_accounts[t]&&(this.trade_accounts[t].ws.close(),delete this.trade_accounts[t],delete this.dm._data.trade[t])}},{key:"updateData",value:function(e){this.dm.mergeData(e,!0,!1)}},{key:"getByPath",value:function(e){return this.dm._getByPath(e)}},{key:"getQuotesByInput",value:function(e){if("string"!=typeof e&&!e.input)return[];var t={input:"string"==typeof e?e.toLowerCase():e.input.toLowerCase(),instrument_id:!e.instrument_id||e.instrument_id,pinyin:!e.pinyin||e.pinyin,include_expired:!!e.include_expired&&e.include_expired,FUTURE:!e.future||!!e.future,FUTURE_INDEX:!!e.future_index&&!!e.future_index,FUTURE_CONT:!!e.future_cont&&!!e.future_cont,OPTION:!!e.option&&!!e.option,COMBINE:!!e.combine&&!!e.combine},n=function(e,t,n){return!(!e[t.class]||!e.include_expired&&(e.include_expired||t.expired))&&("instrument_id"===n?t.product_id.toLowerCase()===e.input||e.input.length>2&&t.instrument_id.toLowerCase().indexOf(e.input)>-1:"pinyin"===n&&t.py.split(",").indexOf(e.input)>-1)},r=[];if(t.instrument_id)for(var o in this.quotesInfo)n(t,this.quotesInfo[o],"instrument_id")&&r.push(o);if(t.pinyin)for(var i in this.quotesInfo)n(t,this.quotesInfo[i],"pinyin")&&r.push(i);return r}},{key:"getQuote",value:function(e){if(""===e)return{};var t=this.dm.setDefault(["quotes",e],QUOTE);if(!t.class&&this.quotesInfo[e]){var n=t.last_price?t.last_price:this.quotesInfo[e].last_price;Object.assign(t,this.quotesInfo[e],{last_price:n})}return t}},{key:"setChart",value:function(e){var t={};e.trading_day_start||e.trading_day_count?(t.trading_day_start=e.trading_day_start?e.trading_day_start:0,t.trading_day_count=e.trading_day_count?e.trading_day_count:864e11):(t.view_width=e.view_width?e.view_width:500,e.left_kline_id?t.left_kline_id=e.left_kline_id:e.focus_datetime&&(t.focus_datetime=e.focus_datetime,t.focus_position=e.focus_position?e.focus_position:0)),this.quotesWs.send(Object.assign({aid:"set_chart",chart_id:e.chart_id?e.chart_id:this._prefix+"kline_chart",ins_list:e.ins_list?e.ins_list.join(","):e.symbol,duration:e.duration},t))}},{key:"getUser",value:function(e){var t="string"==typeof e?e:e.user_id;return t?this.dm._data.trade[t]:null}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=void 0===t?"users":t,r=e.user_id,o=void 0===r?"":r,i=e.currency,a=void 0===i?"CNY":i,s=e.symbol,u=void 0===s?"":s,c=e.order_id,f=void 0===c?"":c,l=e.trade_id,d=void 0===l?"":l,h=e.trading_day,p=void 0===h?"":h,_=e.chart_id,v=void 0===_?"":_,y=e.input,m=void 0===y?"":y,g=e.duration,b=void 0===g?0:g;if("users"===n)return Object.keys(this.trade_accounts);if(o){var w=this.get_user(o);if("user"===n)return w;if(["session","accounts","positions","orders","trades","his_settlements"].indexOf(n)>-1)return w&&w[n]?w[n]:null;if(w&&w[n+"s"]){var S="account"===n?a:"position"===n?u:"order"===n?f:"trade"===n?d:"his_settlement"===n?p:"";return w[n+"s"][S]}return null}return"quotes"===n?m?this.get_quotes_by_input(m):[]:"quote"===n?this.getQuote(u):"klines"===n?this.dm.getKlines(u,b):"ticks"===n?this.dm.getTicks(u):"charts"===n?this.dm.getByPath(["charts"]):"chart"===n?this.dm.getByPath(["charts",v]):void 0}},{key:"getKlines",value:function(e,t){if(""===e)return null;var n=this.dm.getByPath(["klines",e,t]);return n&&n.data&&-1!==n.last_id||this.dm.mergeData({klines:_defineProperty({},e,_defineProperty({},t,{last_id:-1,data:{}}))},!1,!1),this.getByPath(["klines",e,t])}},{key:"getTicks",value:function(e){if(""===e)return null;var t=this.dm.getByPath(["ticks",e]);return t&&t.data||this.dm.mergeData({ticks:_defineProperty({},e,{last_id:-1,data:{}})},!1,!1),this.dm.getByPath(["ticks",e])}},{key:"isLogined",value:function(e){var t=this.get({name:"session",user_id:e.user_id});return!(!t||!t.trading_day)}},{key:"isChanging",value:function(e,t){return e&&e._epoch?e._epoch===this.dm._epoch:"string"==typeof e&&this.dm.isChanging(e,t)}},{key:"insertOrder",value:function(e){if(!this.is_logined(e))return null;var t=this._prefix+RandomStr(8),n={user_id:e.user_id,orderId:t,exchange_id:e.exchange_id,instrument_id:e.ins_id,direction:e.direction,offset:e.offset,price_type:e.price_type?e.price_type:"LIMIT",limit_price:Number(e.limit_price),volume_condition:"ANY",time_condition:"ANY"===e.price_type?"IOC":"GFD"},r=Object.assign({aid:"insert_order",volume:e.volume},n);this.trade_accounts[e.user_id].ws.send(r);var o=Object.assign({volume_orign:e.volume,status:"ALIVE",volume_left:e.volume},n);return this.dm.mergeData({trade:_defineProperty({},e.user_id,{orders:_defineProperty({},t,o)})},!1,!1),this.get({name:"order",user_id:e.user_id,orderId:t})}},{key:"autoInsertOrder",value:function(e){if(!this.is_logined(e))return null;var t={user_id:e.user_id,price_type:e.price_type?e.price_type:"LIMIT",volume_condition:"ANY",time_condition:"ANY"===e.price_type?"IOC":"GFD",exchange_id:e.exchange_id,instrument_id:e.ins_id,direction:e.direction,limit_price:Number(e.limit_price)};if("SHFE"===e.exchange_id&&"CLOSE"===e.offset){var n=this.dm.getPosition(e.symbol,e.user_id),r=0;"BUY"===e.direction&&n.volume_short_today>0?r=Math.min(n.volume_short_today,e.volume):"SELL"===e.direction&&n.volume_long_today>0&&(r=Math.min(n.volume_long_today,e.volume)),r>0&&this.insert_order(Object.assign({offset:"CLOSETODAY",volume:r},t)),e.volume-r>0&&this.insert_order(Object.assign({offset:"CLOSE",volume:e.volume-r},t))}else this.insert_order(Object.assign({offset:e.offset,volume:e.volume},t))}},{key:"cancelOrder",value:function(e){this.trade_accounts[e.user_id].ws.send({aid:"cancel_order",user_id:e.user_id,order_id:e.order_id?e.order_id:e})}},{key:"login",value:function(e){this.trade_accounts[e.user_id].ws.send({aid:"req_login",bid:e.bid,user_name:e.user_id,password:e.password,client_system_info:this.clientSystemInfo,client_app_id:this.clientAppId})}},{key:"confirmSettlement",value:function(e){this.trade_accounts[e.user_id].ws.send({aid:"confirm_settlement"})}},{key:"transfer",value:function(e){this.trade_accounts[e.user_id].ws.send({aid:"req_transfer",bank_id:e.bank_id,bank_password:e.bank_password,future_account:e.future_account,future_password:e.future_password,currency:"CNY",amount:e.amount})}},{key:"hisSettlement",value:function(e){if(!t.store)return null;var n=this.dm._getByPath(["trade",e.user_id,"his_settlements",e.trading_day]);if(void 0===n){var r=this;n=t.store.getContent(e.user_id,e.trading_day).then((function(t){if(null===t)r.trade_accounts[e.user_id].ws.send({aid:"qry_settlement_info",trading_day:Number(e.trading_day)});else{var n=ParseSettlementContent(t);r.dm.mergeData({trade:_defineProperty({},e.user_id,{his_settlements:_defineProperty({},e.trading_day,n)})},!0,!1)}})).catch((function(e){console.log(e)}))}}},{key:"subscribeQuote",value:function(e){this.quotesWs.send({aid:"subscribe_quote",ins_list:Array.isArray(e)?e.join(","):e})}}]),t}(eventemitter3);TQSDK.prototype.subscribe_quote=TQSDK.prototype.subscribeQuote,TQSDK.prototype.his_settlement=TQSDK.prototype.hisSettlement,TQSDK.prototype.confirm_settlement=TQSDK.prototype.confirmSettlement,TQSDK.prototype.add_account=TQSDK.prototype.addAccount,TQSDK.prototype.remove_account=TQSDK.prototype.removeAccount,TQSDK.prototype.update_data=TQSDK.prototype.updateData,TQSDK.prototype.get_by_path=TQSDK.prototype.getByPath,TQSDK.prototype.get_quotes_by_input=TQSDK.prototype.getQuotesByInput,TQSDK.prototype.get_quote=TQSDK.prototype.getQuote,TQSDK.prototype.set_chart=TQSDK.prototype.setChart,TQSDK.prototype.get_user=TQSDK.prototype.getUser,TQSDK.prototype.is_logined=TQSDK.prototype.isLogined,TQSDK.prototype.is_changed=TQSDK.prototype.isChanging,TQSDK.prototype.insert_order=TQSDK.prototype.insertOrder,TQSDK.prototype.auto_insert_order=TQSDK.prototype.autoInsertOrder,TQSDK.prototype.cancel_order=TQSDK.prototype.cancelOrder;var localforage=createCommonjsModule((function(e,t){
/*!
        localForage -- Offline Storage, Improved
        Version 1.7.3
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */
e.exports=function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,(function(e){var n=t[a][1][e];return o(n||e)}),f,f.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof commonjsRequire&&commonjsRequire,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var i=0,a=new o(f),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){f(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(f,0)};else{var u=new e.MessageChannel;u.port1.onmessage=f,n=function(){u.port2.postMessage(0)}}var c=[];function f(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}t.exports=function(e){1!==c.push(e)||r||n()}}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var i={},a=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==o&&h(this,e)}function f(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return i.reject(e,t)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function o(t){n||(n=!0,i.resolve(e,t))}var a=p((function(){t(o,r)}));"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(o);return this.state!==u?l(n,this.state===s?e:t,this.outcome):this.queue.push(new f(n,e,t)),n},f.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},f.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},f.prototype.callRejected=function(e){i.reject(this.promise,e)},f.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)h(e,r);else{e.state=s,e.outcome=t;for(var o=-1,a=e.queue.length;++o<a;)e.queue[o].callFulfilled(t)}return e},i.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:i.resolve(new this(o),e)},c.reject=function(e){var t=new this(o);return i.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,u=-1,c=new this(o);++u<n;)f(e[u],u);return c;function f(e,o){t.resolve(e).then((function(e){a[o]=e,++s!==n||r||(r=!0,i.resolve(c,a))}),(function(e){r||(r=!0,i.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a,s=-1,u=new this(o);++s<n;)a=e[s],t.resolve(a).then((function(e){r||(r=!0,i.resolve(u,e))}),(function(e){r||(r=!0,i.reject(u,e))}));return u}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var l="local-forage-detect-blob-support",d=void 0,h={},p=Object.prototype.toString,_="readonly",v="readwrite";function y(e){return"boolean"==typeof d?a.resolve(d):function(e){return new a((function(t){var n=e.transaction(l,v),r=i([""]);n.objectStore(l).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function m(e){var t=h[e.name],n={};n.promise=new a((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function g(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function b(e,t){var n=h[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function w(e,t){return new a((function(n,r){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);m(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(l)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){n(a.result),g(e)}}))}function S(e){return w(e,!1)}function I(e){return w(e,!0)}function T(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function E(e){return i([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function C(e){return e&&e.__local_forage_encoded_blob}function D(e){var t=this,n=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function k(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(r>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),I(e)})).then((function(){return function(e){m(e);for(var t=h[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,S(e).then((function(t){return e.db=t,T(e)?I(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw b(e,t),t}))}(e).then((function(){k(e,t,n,r-1)}))})).catch(n);n(o)}}var O={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=h[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},h[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=D);var i=[];function s(){return a.resolve()}for(var u=0;u<o.forages.length;u++){var c=o.forages[u];c!==t&&i.push(c._initReady().catch(s))}var f=o.forages.slice(0);return a.all(i).then((function(){return n.db=o.db,S(n)})).then((function(e){return n.db=e,T(n,t._defaultConfig.version)?I(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<f.length;r++){var i=f[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))},_support:function(){try{if(!o)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){k(n._dbInfo,_,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;C(r)&&(r=E(r));var o=e(r,n.key,s++);void 0!==o?t(o):n.continue()}else t()},a.onerror=function(){r(a.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new a((function(t,r){n.ready().then((function(){k(n._dbInfo,_,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),C(e)&&(e=E(e)),t(e)},a.onerror=function(){r(a.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var o=new a((function(n,o){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===p.call(t)?y(i.db).then((function(e){return e?t:(n=t,new a((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){k(r._dbInfo,v,(function(i,a){if(i)return o(i);try{var s=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),n(t)},a.onabort=a.onerror=function(){var e=u.error?u.error:u.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return s(o,n),o},removeItem:function(e,t){var n=this;e=c(e);var r=new a((function(t,r){n.ready().then((function(){k(n._dbInfo,v,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){k(t._dbInfo,v,(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){k(t._dbInfo,_,(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){e<0?t(null):n.ready().then((function(){k(n._dbInfo,_,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName),s=!1,u=a.openCursor();u.onsuccess=function(){var n=u.result;n?0===e?t(n.key):s?t(n.key):(s=!0,n.advance(e)):t(null)},u.onerror=function(){r(u.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){k(t._dbInfo,_,(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).openCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=f.apply(this,arguments);var n,r=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),e.name){var i=e.name===r.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):S(e).then((function(t){var n=h[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));n=e.storeName?i.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;m(e);var r=h[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var u=i[s];u._dbInfo.db=null,u._dbInfo.version=n}return new a((function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,g(n._dbInfo)}})).catch((function(t){throw(b(e,t)||a.resolve()).catch((function(){})),t}))}})):i.then((function(t){m(e);var n=h[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;return new a((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)g(r[t]._dbInfo)})).catch((function(t){throw(b(e,t)||a.resolve()).catch((function(){})),t}))}))}else n=a.reject("Invalid arguments");return s(n,t),n}},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",j="~~local_forage_type~",A=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:",R=N.length,B="arbf",q="blob",P="si08",L="ui08",U="uic8",M="si16",Q="si32",F="ur16",K="ui32",W="fl32",z="fl64",H=R+B.length,G=Object.prototype.toString;function V(e){var t,n,r,o,i,a=.75*e.length,s=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),f=new Uint8Array(c);for(t=0;t<s;t+=4)n=x.indexOf(e[t]),r=x.indexOf(e[t+1]),o=x.indexOf(e[t+2]),i=x.indexOf(e[t+3]),f[u++]=n<<2|r>>4,f[u++]=(15&r)<<4|o>>2,f[u++]=(3&o)<<6|63&i;return c}function Y(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=x[n[t]>>2],r+=x[(3&n[t])<<4|n[t+1]>>4],r+=x[(15&n[t+1])<<2|n[t+2]>>6],r+=x[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var X={serialize:function(e,t){var n="";if(e&&(n=G.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===G.call(e.buffer))){var r,o=N;e instanceof ArrayBuffer?(r=e,o+=B):(r=e.buffer,"[object Int8Array]"===n?o+=P:"[object Uint8Array]"===n?o+=L:"[object Uint8ClampedArray]"===n?o+=U:"[object Int16Array]"===n?o+=M:"[object Uint16Array]"===n?o+=F:"[object Int32Array]"===n?o+=Q:"[object Uint32Array]"===n?o+=K:"[object Float32Array]"===n?o+=W:"[object Float64Array]"===n?o+=z:t(new Error("Failed to get type for BinaryArray"))),t(o+Y(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n=j+e.type+"~"+Y(this.result);t(N+q+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,R)!==N)return JSON.parse(e);var t,n=e.substring(H),r=e.substring(R,H);if(r===q&&A.test(n)){var o=n.match(A);t=o[1],n=n.substring(o[0].length)}var a=V(n);switch(r){case B:return a;case q:return i([a],{type:t});case P:return new Int8Array(a);case L:return new Uint8Array(a);case U:return new Uint8ClampedArray(a);case M:return new Int16Array(a);case F:return new Uint16Array(a);case Q:return new Int32Array(a);case K:return new Uint32Array(a);case W:return new Float32Array(a);case z:return new Float64Array(a);default:throw new Error("Unkown type: "+r)}},stringToBuffer:V,bufferToString:Y};function J(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function $(e,t,n,r,o,i){e.executeSql(n,r,o,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?i(e,a):J(e,t,(function(){e.executeSql(n,r,o,i)}),i)}),i):i(e,a)}),i)}function Z(e,t,n,r){var o=this;e=c(e);var i=new a((function(i,a){o.ready().then((function(){void 0===t&&(t=null);var s=t,u=o._dbInfo;u.serializer.serialize(t,(function(t,c){c?a(c):u.db.transaction((function(n){$(n,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(s)}),(function(e,t){a(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void i(Z.apply(o,[e,s,n,r-1]));a(t)}}))}))})).catch(a)}));return s(i,n),i}var ee={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new a((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){J(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=X,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){$(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var i=r.rows,a=i.length,s=0;s<a;s++){var u=i.item(s),c=u.value;if(c&&(c=o.serializer.deserialize(c)),void 0!==(c=e(c,u.key,s+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){$(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return Z.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=c(e);var r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){$(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){$(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){$(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){$(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){$(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return s(r=e.name?new a((function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(function(e){return new a((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}(r))})).then((function(e){return new a((function(t,n){e.db.transaction((function(r){function o(e){return new a((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var i=[],s=0,u=e.storeNames.length;s<u;s++)i.push(o(e.storeNames[s]));a.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):a.reject("Invalid arguments"),t),r}};function te(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function ne(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var re={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=te(e,this._defaultConfig),ne()?(this._dbInfo=t,t.serializer=X,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,i=localStorage.length,a=1,s=0;s<i;s++){var u=localStorage.key(s);if(0===u.indexOf(r)){var c=localStorage.getItem(u);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,u.substring(o),a++)))return c}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new a((function(o,i){var a=r._dbInfo;a.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return s(o,n),o},removeItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return s(r=e.name?new a((function(t){e.storeName?t(te(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):a.reject("Invalid arguments"),t),r}},oe=function(e,t){for(var n,r,o=e.length,i=0;i<o;){if((n=e[i])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;i++}return!1},ie=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ae={},se={},ue={INDEXEDDB:O,WEBSQL:ee,LOCALSTORAGE:re},ce=[ue.INDEXEDDB._driver,ue.WEBSQL._driver,ue.LOCALSTORAGE._driver],fe=["dropInstance"],le=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(fe),de={description:"",driver:ce.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function he(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function pe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(ie(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var _e=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue)if(ue.hasOwnProperty(n)){var r=ue[n],o=r._driver;this[n]=o,ae[o]||this.defineDriver(r)}this._defaultConfig=pe({},de),this._config=pe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new a((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var i=le.concat("_initStorage"),u=0,c=i.length;u<c;u++){var f=i[u];if((!oe(fe,f)||e[f])&&"function"!=typeof e[f])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=a.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=fe.length;n<r;n++){var o=fe[n];e[o]||(e[o]=t(o))}}();var l=function(n){ae[r]&&console.info("Redefining LocalForage driver: "+r),ae[r]=e,se[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(l,n):l(!!e._support):l(!0)}catch(e){n(e)}}));return u(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=ae[e]?a.resolve(ae[e]):a.reject(new Error("Driver not found."));return u(r,t,n),r},e.prototype.getSerializer=function(e){var t=a.resolve(X);return u(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;ie(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function s(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve();return this._driverSet=c.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(s).catch(n)}i();var u=new Error("No available storage method found.");return r._driverSet=a.reject(u),r._driverSet}()}}(o)}))})).catch((function(){i();var e=new Error("No available storage method found.");return r._driverSet=a.reject(e),r._driverSet})),u(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!se[e]},e.prototype._extend=function(e){pe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=le.length;e<t;e++)he(this,le[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=_e},{3:3}]},{},[4])(4)}));TQSDK.axios=axios$1,TQSDK.TqWebsocket=TqWebsocket,TQSDK.TQData=DataManager,TQSDK.version=version;var DB_NAME="his_settlements",stores={},oldVersion=localStorage.getItem("cc_db_ver");if(oldVersion!==db_version){var DBDeleteRequest=indexedDB.deleteDatabase(DB_NAME);DBDeleteRequest.onerror=function(e){console.log("Error deleting database.")},DBDeleteRequest.onsuccess=function(e){localStorage.setItem("cc_db_ver",db_version)}}return TQSDK.store={getContent:function(e,t){return void 0===stores[e]&&(stores[e]=localforage.createInstance({name:DB_NAME,storeName:e})),stores[e].getItem(String(t))},setContent:function(e,t,n){return void 0===stores[e]&&(stores[e]=localforage.createInstance({name:DB_NAME,storeName:e})),stores[e].setItem(String(t),n)}},TQSDK}));
